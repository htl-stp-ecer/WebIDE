<div class="h-full flex flex-col">
  <p-contextMenu #missionMenu [model]="contextMenuItems"></p-contextMenu>
  <!-- Timeline Section -->
  <div class="flex-1 overflow-hidden">
    <!-- Fixed Top: setups (and both) -->
    <p-timeline
      [value]="topMissions"
      layout="vertical"
      class="max-h-full overflow-y-auto p-4"
    >
      <ng-template let-item let-i="index" pTemplate="content">
        <div
          class="flex items-center gap-3 cursor-pointer px-2 py-1 rounded-lg transition-colors"
          (click)="getDetailedMission(item.name)"
          [ngClass]="{
      'bg-blue-100 border border-blue-400 dark:bg-blue-900 dark:border-blue-500':
        currentMission?.name === item.name
    }"
        >
          <span class="text-gray-500 dark:text-gray-400">{{ item.order }}</span>
          <span class="text-gray-800 dark:text-gray-200">{{ item.name }}</span>
          <i class="pi pi-lock text-gray-400 dark:text-gray-500 ml-auto"></i>
        </div>
      </ng-template>
    </p-timeline>

    <!-- Reorderable Middle -->
    <p-timeline
      cdkDropList
      [cdkDropListData]="middleMissions"
      (cdkDropListDropped)="dropMiddle($event)"
      [value]="middleMissions"
      layout="vertical"
      class="max-h-full overflow-y-auto p-4"
    >
      <ng-template let-item let-i="index" pTemplate="content">
        <div
          cdkDrag
          class="flex items-center gap-3 cursor-pointer px-2 py-1 rounded-lg transition-colors"
          (click)="getDetailedMission(item.name)"
          (contextmenu)="onRightClickMission($event, item)"
          [ngClass]="{
      'bg-blue-100 border border-blue-400 dark:bg-blue-900 dark:border-blue-500':
        currentMission?.name === item.name
    }"
        >
          <span class="text-gray-500 dark:text-gray-400">{{ item.order }}</span>
          <span class="text-gray-800 dark:text-gray-200">{{ item.name }}</span>
          <i class="pi pi-bars text-gray-400 dark:text-gray-500 ml-auto"></i>
        </div>
      </ng-template>
    </p-timeline>

    <!-- Fixed Bottom: shutdown-only -->
    <p-timeline
      [value]="bottomMissions"
      layout="vertical"
      class="max-h-full overflow-y-auto p-4"
    >
      <ng-template let-item let-i="index" pTemplate="content">
        <div
          class="flex items-center gap-3 cursor-pointer px-2 py-1 rounded-lg transition-colors"
          (click)="getDetailedMission(item.name)"
          [ngClass]="{
      'bg-blue-100 border border-blue-400 dark:bg-blue-900 dark:border-blue-500':
        currentMission?.name === item.name
    }"
        >
          <span class="text-gray-500 dark:text-gray-400">{{ item.order }}</span>
          <span class="text-gray-800 dark:text-gray-200">{{ item.name }}</span>
          <i class="pi pi-lock text-gray-400 dark:text-gray-500 ml-auto"></i>
        </div>
      </ng-template>
    </p-timeline>
  </div>
  <!-- Add Mission Section (Outside Timeline) -->
  <div class="p-4 border-t border-gray-200 mb-10">
    @if (!addingMission) {
      <p-card
        class="shadow-md rounded-2xl border border-dashed border-gray-300 hover:border-gray-500 hover:shadow transition-all cursor-pointer"
        (click)="enableAddMission()">
        <button class="flex flex-col items-center justify-center w-full py-4 text-gray-500 hover:text-gray-700">
          <i class="pi pi-plus text-3xl mb-2"></i>
          <span class="text-lg font-medium">Add Mission</span>
        </button>
      </p-card>
    } @else {
      <p-card class="shadow-md rounded-2xl">
        <div class="flex flex-col space-y-4 w-full">
          <input [(ngModel)]="newMissionName"
                 pInputText
                 placeholder="Mission name"
                 class="w-full"/>
          <div class="flex justify-end gap-2">
            <p-button
              label="Cancel"
              size="small"
              severity="secondary"
              (onClick)="cancelAddMission()"/>
            <p-button
              label="Save"
              size="small"
              severity="success"
              (onClick)="createMission()"/>
          </div>
        </div>
      </p-card>
    }
  </div>
</div>
