<f-flow fDraggable
        (fLoaded)="onLoaded()"
        (fCreateNode)="onCreateNode($event)"
        (fCreateConnection)="addConnection($event)">
  <f-background>
    <f-circle-pattern color="#4a5565"></f-circle-pattern>
  </f-background>

  <f-canvas fZoom>
    <f-connection-for-create
      fType="segment"
      [fStartColor]="isDarkMode ? '#EEE5E9' : '#131217'"
      [fEndColor]="isDarkMode ? '#EEE5E9' : '#131217'"></f-connection-for-create>
    <f-snap-connection
      [fSnapThreshold]="50"
      fType="segment"
      [fStartColor]="isDarkMode ? '#EEE5E9' : '#131217'"
      [fEndColor]="isDarkMode ? '#EEE5E9' : '#131217'"
    ></f-snap-connection>

    @for (connection of connections(); track connection.outputId + '-' + connection.inputId) {
      <f-connection [fReassignDisabled]="true" fType="segment"
                    [fOutputId]="connection.outputId" [fInputId]="connection.inputId"
                    [fStartColor]="isDarkMode ? '#EEE5E9' : '#131217'"
                    [fEndColor]="isDarkMode ? '#EEE5E9' : '#131217'">
      </f-connection>
    }

    @for (node of nodes(); track node.id) {
      <div fNode fDragHandle [fNodePosition]="node.position"
           class="relative w-36 p-4 text-center
                  bg-[#eee5e9] border border-[#383838] rounded-xl
                  shadow hover:shadow-lg transition-shadow duration-200
                  dark:bg-[#131217] dark:border-[#383838] dark:text-[#EEE5E9]">

        <!-- Top port -->
        <div fNodeInput fInputConnectableSide="top"
             class="absolute w-3 h-3 bg-[#383838] rounded-full -top-1.5 left-1/2 -translate-x-1/2"></div>

        <!-- Node content -->
        <div class="font-semibold">{{ node.text }}</div>

        <!-- Bottom port -->
        <div fNodeOutput fOutputConnectableSide="bottom"
             class="absolute w-3 h-3 bg-[#383838] rounded-full -bottom-1.5 left-1/2 -translate-x-1/2"></div>
      </div>
    }
  </f-canvas>
</f-flow>
